# v8.24.0 Release Notes - Root Cause Fixes

## Executive Summary
v8.24.0 addresses fundamental root causes identified in travel/tourism research queries, implementing surgical fixes that ensure successful evidence collection and triangulation for diverse query types.

## Core Issues Addressed

### 1. Mastercard PDF Fetch Failures (403 Errors)
**Root Cause**: Mastercard and similar corporate domains block headless clients without proper browser headers.
**Fix**: Implemented domain-specific header configuration system with browser-like headers and referrer URLs.

### 2. Intent-Aware Quality Thresholds
**Root Cause**: Global quality thresholds (50%/45%/25%) were inappropriate for travel/tourism queries that rely on diverse sources.
**Fix**: Created `QualityThresholds` system with intent-specific configurations. Travel queries now use 30%/25%/35% thresholds even in strict mode.

### 3. Aggressive Contradiction Filtering
**Root Cause**: Contradiction filter was removing valid multi-domain clusters with minor numeric disagreements.
**Fix**: Enhanced contradiction detection with:
- 35% tolerance for numeric disagreements
- Domain diversity requirements (3+ domains)
- Preservation of trusted domain clusters
- Only 10% conflict rate threshold for filtering

### 4. Missing Primary Source Recognition
**Root Cause**: Authoritative PDFs with numeric content weren't recognized as primary sources.
**Fix**: Enhanced primary detection to recognize:
- PDFs from authoritative organizations with numeric content
- Semi-authoritative sources (Mastercard, Deloitte, etc.) with metrics
- Government/academic PDFs with data

### 5. Irrelevant SEC Queries for Travel
**Root Cause**: Query generator was adding SEC site filters for all queries regardless of intent.
**Fix**: Implemented intent-aware domain blocklists. SEC queries are now blocked for travel/tourism intents.

## Technical Implementation

### New Modules
- `research_system/quality/thresholds.py` - Intent-aware quality threshold management
- `research_system/quality/primary_detection.py` - Enhanced primary source detection

### Modified Components
- **OECD Provider**: Multiple endpoint fallback with alt-host support
- **HTTP Headers**: Per-domain header configuration for API compliance
- **Orchestrator**: Intent-aware thresholds throughout pipeline
- **Contradiction Filter**: More lenient numeric tolerance and domain awareness
- **Query Builder**: Intent-specific domain blocklisting

## Configuration

### Intent-Specific Thresholds
```python
# Travel/Tourism (Strict Mode)
primary_share: 30%
triangulation: 25%
domain_cap: 35%

# Stats/Economic (Strict Mode)
primary_share: 60%
triangulation: 40%
domain_cap: 30%

# Medical/Health (Strict Mode)
primary_share: 65%
triangulation: 50%
domain_cap: 20%
```

### Domain-Specific Headers
```python
# Mastercard
User-Agent: Mozilla/5.0 (real browser string)
Accept: application/pdf,application/octet-stream
Referer: https://www.mastercard.com/newsroom/

# SEC
User-Agent: ResearchAgent/1.0 (contact@example.com)
Accept-Encoding: identity
```

## Performance Impact

### Before v8.24.0
- Travel queries: 20% primary share, 0% triangulation
- Repeated 403 errors on Mastercard PDFs
- Unnecessary SEC queries burning budget
- Valid clusters dropped as contradictory

### After v8.24.0
- Travel queries: 30%+ primary share, 25%+ triangulation
- Successful PDF fetching from corporate domains
- No irrelevant domain queries
- Multi-domain clusters preserved

## Testing
- 439 tests passing
- 8 tests updated for new behavior
- Intent-specific threshold validation
- Domain header compliance verified

## Migration Notes
- No breaking changes
- Backward compatible with existing queries
- Automatic intent detection and threshold selection
- Configurable via environment variables

## Known Issues
- Some older test files may need updating for OECD endpoint changes
- Fetcher circuit breaker logic pending optimization (tracked separately)

## Credits
Based on detailed root cause analysis from third-party review. Implements all recommended fixes including optional enhancements.